\chapter{Constructing quotient inductive types}
\label{constructing}

For ordinary inductive types, it is usual that if one wants to add
them to a theory, the ``easiest'' way is to add a primitive that gives
us an initial algebra for a strictly positive functor on $\Type$, \ie
a functor given as a $\Type$-container. This primitive is called the
\emph{W-type}. Every ordinary inductive type can be written in terms
of this primitive. The benefit of such a primitive is that when we
want to analyse the theory, we do not have to adjust our analyses
every time we add an inductive type. In terms of programming, there
are some downsides to writing everything using W-types however.

In this chapter we will see that it is possible to perform the
construction of initial objects via sequential colimits in type theory
itself. With this construction, we get quotient inductive-inductive
definitions by having certain ordinals, arbitrary coproducts and
coequalisers.

\section{Strict positivity}

In \cref{from-syntax-to-functors} we have seen that not every list of
constructors can be made sense of in terms of being objects of
categories of algebras. In order for the arguments of the constructors
to describe functors, the recursive occurrences have to all be in
positive positions. 

Even if we consider endofunctors on $\Set$, its initial algberas need
not exist: the types we are talking about have to be \emph{strictly}
positive. One example of a functor that does not have an initial
algebra is the \emph{double powerset functor}
$P X \ddefeq (X \to 2) \to 2$. By Lambek's theorem the initial algebra
would give us a set $X$ such that $X = P X$. If we then apply Cantor's
theorem, we arrive at a contradiction.

\section{Generalising W-types}

The W-types primitive gives us initial algebras for containers on
$\Set$. In this section we will explore generalising this concept to
quotient inductive-inductive definitions.

Having W-types in our type theory means we have a primitive:
$$
\wty : \cont{S}{P} \to \Type
$$
which comes with the following:
\begin{itemize}
\item $\wsup_{\cont{S}{P}} : (P : \wty_{\cont{S}{P}} \to \Type)\ (m : (x : \context{\cont{S}{P}}\ \wty_{\cont{s}{p}}) \to \Box_{\context{\cont{S}{P}}}\ P\ x \to P\ (\wsup\ x)) \to (x : \wty_{\cont{S}{P}}) \to P\ x$
\item $\welim : ?$
\item $\welimbeta : ?$
\end{itemize}

In other words: $W$ gives us an algebra for a container on $\Type$
which satisfies the induction principle.

\section{Initial objects via sequential colimits}

Initial algebras of an endofunctor can be 

\begin{theorem}[Ad\'amek]
  \label{adamek-thm}
  Let $\Cc : \Cat$ be a category with an endofunctor
  $F : \Func{\Cc}{\Cc}$. The category of algebras $\algcat{F}$ has an
  initial object if $\Cc$ has sequential colimits and an initial
  object and $F$ preserves these colimits.
\end{theorem}

\begin{proof}
  Define $X_\omega$ as the colimit of the cochain:
  $$
  \xymatrix{
    \initobj \ar[r]^{\inithom} 
    &F\ \initobj \ar[r]^{F \inithom} 
    &F^2\ \initobj \ar[r]^{F^2 \inithom} 
    &F^3\ \initobj \ar[r]^{F^3 \inithom} 
    &F^4\ \initobj \ar[r] 
    &\hdots
  }
  $$
  Observe that if we apply $F$ to this cochain, we end up with the
  same cochain, as we can just put the initial object in front of it
  without changing anything. Since $F$ preserves colimits of cochains,
  the colimit of this is $F X_\omega$. This gives us an isomorphism
  $X_\omega \simeq F X_\omega$, hence we get an algebra structure
  $\theta_\omega$ on $X_\omega$.

  We need to check whether $(X_\omega,\theta_\omega)$ is initial.
\end{proof}

\subsection{$\Set$-sorted inductive-inductive definitions}

Before we try to tackle the general case, we will look at the
simplified setting of $\Set$-sorted inductive-inductive
definitions. The categories of algebras in this case are categories of
dialgebras. As it turns out, these categories are equivalent to
ordinary categories of algebras for some endofunctor.

Observe that if we have $F : \Func{\Cc}{\Cc}$ such that $F$ and $\Cc$
satisfy the conditions of \cref{adamek-thm}, then the forgetful
functor $U : \Func{\algcat{F}}{\Cc}$ has a left adjoint:

\begin{proposition}
  Let $F : \Func{\Cc}{\Cc}$ be an endofunctor on a category
  $\Cc : \Cat$ which has initial object, binary coproducts and
  sequential colimits. Suppose furthermore that $F$ preserves
  sequential colimits, then the forgetful functor
  $U : \Func{algcat{F}}{\Cc}$ has a left adjoint.
\end{proposition}

\begin{proof}
  The left adjoint is defined pointwise: for $A : \Cc$, $L A$ is
  defined as the initial algebra of the functor $\lambda X . A + FX$.
  This functor again satisfies the conditions of \cref{adamek-thm}, so
  these initial algebras exist.

  We then need to check whether 
  
  
\end{proof}

\begin{proposition}
  Let $\Cc$ be a category with sequential colimits and
  $F : \Func{\Cc}{\Cc}$ be a functor that preserves them. The category
  $\algcat{F}$ has sequential colimits.
\end{proposition}

\begin{proof}
  Suppose we have the following cochain in $\algcat{F}$:
  $$
  \xymatrix{
    (X_0,\theta_0) \ar[r]^{x_0}
    &(X_1,\theta_1) \ar[r]^{x_1} 
    &(X_2,\theta_1) \ar[r]^{x_2} 
    &(X_3,\theta_1) \ar[r]^{x_3}
    &(X_4,\theta_1) \ar[r]
    &\hdots
  }
  $$
  This means we have the following diagram in $\Cc$:
  $$
  \xymatrix{
    F X_0 \ar[r]^{F x_0} \ar[d]_{\theta_0}
    &F X_1 \ar[r]^{F x_1} \ar[d]_{\theta_1}
    &F X_2 \ar[r]^{F x_2} \ar[d]_{\theta_2}
    &F X_3 \ar[r]^{F x_3} \ar[d]_{\theta_3}
    &F X_4 \ar[r] \ar[d]_{\theta_4} 
    &\hdots
    \\
    X_0 \ar[r]_{x_0}
    &X_1 \ar[r]_{x_1}
    &X_2 \ar[r]_{x_2}
    &X_3 \ar[r]_{x_3}
    &X_4 \ar[r]
    &\hdots
  }
  $$
  We can take the colimit of the bottom sequence $(X_i,x_i)$, which
  will have an algebra structure as $F$ preserves colimits of
  cochains. However, we need to make sure that all the inclusion maps
  $X_i \to X_\omega$ are algebra morphisms.
\end{proof}

\begin{proposition}
  Let $s : \specty$ be a specification of a $\Set$-sorted
  inductive-inductive definition. If every arguments functor $F_i$
  preserves sequential colimits, the forgetful functor
  $U : \Func{\Alg_s}{\Set}$ has a left adjoint.
\end{proposition}

\begin{proof}
  
\end{proof}

\begin{proposition}
  Let $s : \specty$ be a specification of a
  $\Set$-sorted inductive-inductive definition. If every arguments
  functor $F_i$ preserves sequential colimits, then
  $\Alg_s$ has an initial object.
\end{proposition}

\begin{proof}
  The category $\Set$ has an initial object $\initty$. There exists an
  adjunction $L \dashv U : \Alg_s$ where $U$ is the
  forgetful functor. Left adjoints preserve colimits, hence
  $L\ \initty$ is initial in $\Alg_s$.
\end{proof}

\subsection{Sort categories}

Suppose we have a sort specification $\Ss : \sortsty$ giving rise to
the following chain of sort categories:
$$
\xymatrix{
\termcat &S_0 \ar[l]_{t_0} &S_1 \ar[l]_{t_1} &\hdots \ar[l]_{t_2} &S_n \ar[l]_{t_n}
}
$$

Note that the forgetful functor $\Func{\Fam}{\Set}$ has a left
adjoint: the truth functor that maps a set $X$ to the family
$\lambda x . \unitty : X \to \Set$. This generalises to any functor in
the abovementioned chain of sort categories:

\begin{proposition}
Every forgetful functor $t_i : \Func{S_{i+1}}{S_i}$ has a left adjoint
\end{proposition}

\begin{proof}
  We define the functor $u_i : \Func{S_i}{S_{i+1}}$ as follows:
  \begin{itemize}
  \item on objects: $u_i X \ddefeq (X , \lambda x . \unitty)$
  \item on morphisms: $u_i f \ddefeq (f , \lambda a\ x . x)$
  \end{itemize}
  We then have to check whether we have for any $X : | S_i |$ and
  $(Y,Q) : | S_{i+1} |$ that
  $$
  S_{i+1}(u_i\ X , (Y,Q)) = S_i(X,Y)
  $$
  which we can show by simple equational reasoning:
  \begin{align*}
      &&S_{i+1}(u_i\ X , (Y,Q)) \\
    &=& S_{i+1}((X,\lambda x . \unitty), (Y,Q)) \\
    &=& (f : S_i(X,Y) \times (g : (a : R_{i+1} X) \to \unitty \to \unitty) \\
    &=& S_i(X,Y)
  \end{align*}

\end{proof}

\subsection{Categories of algebras}

\subsubsection{0-constructors}

\subsubsection{1-constructors}
