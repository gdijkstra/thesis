\chapter{Constructing quotient inductive-inductive definitions}
\label{constructing}

We have given a formal definition of what constitutes a quotient
inductive-inductive definition in terms of algebraic semantics. We
have shown that the resulting categories of algebras are sensible in
the sense that an algebra is initial if and only if it satisfies the
induction principle. We have therefore shown that the initial algebras
are well-behaved in this regard. To justify adding quotient
inductive-inductive types to the theory, we still need to establish
their existence in the usual models. After all, these results are all
uninteresting if these models do not have quotient inductive-inductive
types, which would make our results vacuously true.

To start out we will address the issue of strict positivity in
inductive definitions and see how we can generalise the notion of
\emph{container} to fit our needs. In this light, we will examine what
the associated generalisation of W-types would be for our inductive
definitions.

Starting from a more semantic point of view, we discuss in
\cref{sequential-colimits} the usual construction of intial algebras
for an endofunctor as a sequential colimit. We explore how this
approach can be both internalised as well as adapted to construct
initial algebras for certain classes of quotient inductive-inductive
definitions.

\section{Strict positivity}

For ordinary inductive types we have to have several syntactic
restrictions on the point constructors in order for the inductive
types to actually exist. We have seen in
\cref{from-syntax-to-functors} that the recursive positions may only
occur in \emph{positive positions} in order for the arguments to
describe a covariant functor. This is not enough to guarantee the
existence of an initial algebra. If we look at $\Set$ and consider the
double powerset functor $P : \Func{\Set}{\Set}$:
$$
P\ X \ddefeq (X \to \boolty) \to \boolty
$$
This defines a covariant functor on $\Set$, yet $\algcat{P}$ does not
have an initial algebra. By Lambek's lemma, having an initial algebra
$(X,\theta) : | \algcat{P} |$ would imply that $\Iso{X}{P\ X}$. By
Cantor's theorem, we know that there is no set $X$ which is isomorphic
to its powerset, hence we arrive at a contradiction.

\subsection{Containers}
The inductive definitions therefore need to be \emph{strictly}
positive: positivity alone does not suffice. There are different ways
to formally specify strictly positive functors. We can use a syntactic
way to describe them as the class of functors that contains all
constant functor, closed under sums and products of strictly positive
functors, exponentiation with a constant on the left of the arrow, and
taking fixpoints\todo{refer to morris constructing universes phd}. A
more compact way to characterise strictly positive functors on $\Set$
in type theory is as \emph{containers}:
%
\begin{definition}
  A \emph{container} on $\Set$ consists of:
  \begin{itemize}
  \item $S : \Set$, a type of \emph{shapes}
  \item $P : S \to \Set$, a family of \emph{position}, indexed by the shapes.
  \end{itemize}
  %
  The container with shapes $S$ and positions $P$ is denoted as
  $\cont{S}{P}$
\end{definition}
%
The corresponding functor is called the \emph{extension} of the container:
%
\begin{definition}
  Given a container $\cont{S}{P}$, its \emph{extension} is the functor
  $\context{\cont{S}{P}} : \Func{\Set}{\Set}$ with its action on objects
  defined as, for every $X : \Set$:
  $$
  \context{\cont{S}{P}}\ X \ddefeq (s : S) \times (P\ s \to X)
  $$
  and its action on functions $f : X \to Y$:
  $$
  \context{\cont{S}{P}}\ f \ddefeq \lambda (s , t) . (s , f \circ t)
  $$
\end{definition}

To give the data for a quotient inductive-inductive definition, we
often need more than just endofunctors on $\Set$. We are generally
working with functors $\Func{\Alg_s}{S_i}$ where $s : \specty$
describes the previous constructors and $S_i$ is sort category
describing the sort of the constructor we are defining. Containers
have a generalisation to \emph{indexed containers} which describe
functors between slice categories of $\Set$. This concept is again an
instance of the more general notion of \emph{polynomial functor},
which describes strictly positive functors between slices categories
of a locally cartesian closed category. We cannot expect $\Alg_s$ to
be locally cartesian closed in general: if we take $s$ to be the
specification corresponding to setoids\todo{have this as an example in
  ``describing'' chapter to refer to}, then $\Alg_s$ is equivalent to
the category setoids, which is not locally cartesian closed\todo{refer
  to note by Nicolai and Thorsten}.

If we look at containers a bit more closely, we see that they are
coproduct of a family of representable functors. This observation
leads us to \emph{generalised containers}, also known as
\emph{famillialy representable functors}\todo{ref to artin gluing
  paper}:
%
\begin{definition}
  A \emph{generalised container} on a category $\Cc$ consists of:
  \begin{itemize}
  \item $S : \Set$, a type of shapes,
  \item $P : S \to | \Cc |$, a family of representing objects, indexed
    by the shapes.
  \end{itemize}
\end{definition}
%
The extension generalises straightforwardly:
%
\begin{definition}
  Given a container $\cont{S}{P}$ on a category $\Cc$, its extension
  is the functor $\context{\cont{S}{P}} : \Func{\Cc}{\Set}$ with its
  action on objects defined as, for every $X : | \Cc |$:
  $$
  \context{\cont{S}{P}}\ X \ddefeq (s : S) \times \Cc(P\ s, X)
  $$
  and its action on functions $f : X \to Y$:
  $$
  \context{\cont{S}{P}}\ f \ddefeq \lambda (s , t) . (s , f \circ t)
  $$
\end{definition}
%
For ordinary containers, there exists a composition operation on
them. For generalised containers, such an operation only makes sense
if the extensions are composable. Even then, the usual construction is
not always possible: suppose we have a $\Cc$-container $\cont{S}{P}$
and a $\Set$-container $\cont{T}{Q}$, given an object $X : | \Cc |$, we can calculate:
\begin{align*}
  \context{\cont{T}{Q}}\ (\context{\cont{S}{P}}\ X) &=& &(t : T) \times (Q\ t \to \context{\cont{S}{P}}) \\
  &=& &(t : T) \times (Q\ t \to (s : S) \times \Cc(P\ s, X)) \\
  &=& &(t : T) \times (a : Q\ t \to S) \times (b : (x : Q\ t) \to \Cc(P\ (a\ x), X))
\end{align*}
Looking at the above computation, a candidate $\Cc$-container whose
extension is equal to the composite
$\context{\cont{T}{Q}} \circ \context{\cont{S}{P}}$ seems to have as shapes
$$
(t : T) \times (Q\ t \to S)
$$
In the ordinary container case, to derive the corresponding positions,
one uses currying on the type of $b$. However, $P$ is a constant
family and $S$ is non-empty, then we can compute the composite
container. This is the case where we compose $\context{\cont{T}{Q}}$
with a representible functor.

\todoi{compute the case where $\context{\cont{S}{P}}$ is a
  representable functor}

The notion of \emph{container morphism}, which are used to represent
natural transformations between containers can be phrased as follows
for generalised containers:
\begin{definition}
  Given $\Cc$-containers $\cont{S}{P}$ and $\cont{T}{Q}$, a container
  morphism consists of:
  \begin{itemize}
  \item $f : S \to T$
  \item $g : (s : S) \to \Cc(Q\ (f\ s), P\ s)$
  \end{itemize}
  with its extension being the natural transformation:
  \begin{align*}
    &\context{f , g} : (X : | \Cc |) \to \context{\cont{S}{P}}\ X \to \context{\cont{T}{Q}}\ X \\
    &\context{f , g}\ X\ (s , t) \ddefeq (f\ s , t \circ (g\ s))
  \end{align*}
  Naturality follows from the associativity law of $\Cc$.
\end{definition}

\subsection{Generalising W-types}


\section{Initial objects via sequential colimits}
\label{sequential-colimits}

Initial algebras of endofunctors can be constructed via sequential
colimits, given some reasonable assumptions on the endofunctor. In
this section we will review this result due to Ad\'amek and see how we
can use it to construct initial dialgebras. We will also discuss how
these proofs can be performed inside type theory itself.

\begin{theorem}[Ad\'amek]
  \label{adamek-thm}
  Let $\Cc : \Cat$ be a category with an endofunctor
  $F : \Func{\Cc}{\Cc}$. The category of algebras $\algcat{F}$ has an
  initial object if $\Cc$ has sequential colimits and an initial
  object and $F$ preserves these colimits.
\end{theorem}

\begin{proof}
  Define $X_\omega$ as the colimit of the cochain:
  $$
  \xymatrix{
    \initobj \ar[r]^{\inithom} 
    &F\ \initobj \ar[r]^{F \inithom} 
    &F^2\ \initobj \ar[r]^{F^2 \inithom} 
    &F^3\ \initobj \ar[r]^{F^3 \inithom} 
    &F^4\ \initobj \ar[r] 
    &\hdots
  }
  $$
  Observe that if we apply $F$ to this cochain, we end up with the
  same cochain, as we can just put the initial object in front of it
  without changing anything. Since $F$ preserves colimits of cochains,
  the colimit of this is $F X_\omega$. This gives us an isomorphism
  $X_\omega \simeq F X_\omega$, hence we get an algebra structure
  $\theta_\omega$ on $X_\omega$.

  We need to check whether $(X_\omega,\theta_\omega)$ is initial.
\end{proof}

\subsection{$\Set$-sorted inductive-inductive definitions}

Before we try to tackle the general case, we will look at the
simplified setting of $\Set$-sorted inductive-inductive
definitions. The categories of algebras in this case are categories of
dialgebras. As it turns out, these categories are equivalent to
ordinary categories of algebras for some endofunctor.

Observe that if we have $F : \Func{\Cc}{\Cc}$ such that $F$ and $\Cc$
satisfy the conditions of \cref{adamek-thm}, then the forgetful
functor $U : \Func{\algcat{F}}{\Cc}$ has a left adjoint:

\begin{proposition}
  Let $F : \Func{\Cc}{\Cc}$ be an endofunctor on a category
  $\Cc : \Cat$ which has initial object, binary coproducts and
  sequential colimits. Suppose furthermore that $F$ preserves
  sequential colimits, then the forgetful functor
  $U : \Func{\algcat{F}}{\Cc}$ has a left adjoint.
\end{proposition}

\begin{proof}
  The left adjoint is defined pointwise: for $A : \Cc$, $L A$ is
  defined as the initial algebra of the functor $\lambda X . A + FX$.
  This functor again satisfies the conditions of \cref{adamek-thm}, so
  these initial algebras exist.

  We then need to check whether 
  
  
\end{proof}

\begin{proposition}
  Let $\Cc$ be a category with sequential colimits and
  $F : \Func{\Cc}{\Cc}$ be a functor that preserves them. The category
  $\algcat{F}$ has sequential colimits.
\end{proposition}

\begin{proof}
  Suppose we have the following cochain in $\algcat{F}$:
  $$
  \xymatrix{
    (X_0,\theta_0) \ar[r]^{x_0}
    &(X_1,\theta_1) \ar[r]^{x_1} 
    &(X_2,\theta_1) \ar[r]^{x_2} 
    &(X_3,\theta_1) \ar[r]^{x_3}
    &(X_4,\theta_1) \ar[r]
    &\hdots
  }
  $$
  This means we have the following diagram in $\Cc$:
  $$
  \xymatrix{
    F X_0 \ar[r]^{F x_0} \ar[d]_{\theta_0}
    &F X_1 \ar[r]^{F x_1} \ar[d]_{\theta_1}
    &F X_2 \ar[r]^{F x_2} \ar[d]_{\theta_2}
    &F X_3 \ar[r]^{F x_3} \ar[d]_{\theta_3}
    &F X_4 \ar[r] \ar[d]_{\theta_4} 
    &\hdots
    \\
    X_0 \ar[r]_{x_0}
    &X_1 \ar[r]_{x_1}
    &X_2 \ar[r]_{x_2}
    &X_3 \ar[r]_{x_3}
    &X_4 \ar[r]
    &\hdots
  }
  $$
  We can take the colimit of the bottom sequence $(X_i,x_i)$, which
  will have an algebra structure as $F$ preserves colimits of
  cochains. However, we need to make sure that all the inclusion maps
  $X_i \to X_\omega$ are algebra morphisms.
\end{proof}

\begin{proposition}
  Let $s : \specty$ be a specification of a $\Set$-sorted
  inductive-inductive definition. If every arguments functor $F_i$
  preserves sequential colimits, the forgetful functor
  $U : \Func{\Alg_s}{\Set}$ has a left adjoint.
\end{proposition}

\begin{proof}
  
\end{proof}

\begin{proposition}
  Let $s : \specty$ be a specification of a
  $\Set$-sorted inductive-inductive definition. If every arguments
  functor $F_i$ preserves sequential colimits, then
  $\Alg_s$ has an initial object.
\end{proposition}

\begin{proof}
  The category $\Set$ has an initial object $\initty$. There exists an
  adjunction $L \dashv U : \Alg_s$ where $U$ is the
  forgetful functor. Left adjoints preserve colimits, hence
  $L\ \initty$ is initial in $\Alg_s$.
\end{proof}

\subsection{Sort categories}

Suppose we have a sort specification $\Ss : \sortsty$ giving rise to
the following chain of sort categories:
$$
\xymatrix{
\termcat &S_0 \ar[l]_{t_0} &S_1 \ar[l]_{t_1} &\hdots \ar[l]_{t_2} &S_n \ar[l]_{t_n}
}
$$

Note that the forgetful functor $\Func{\Fam}{\Set}$ has a left
adjoint: the truth functor that maps a set $X$ to the family
$\lambda x . \unitty : X \to \Set$. This generalises to any functor in
the abovementioned chain of sort categories:

\begin{proposition}
Every forgetful functor $t_i : \Func{S_{i+1}}{S_i}$ has a left adjoint
\end{proposition}

\begin{proof}
  We define the functor $u_i : \Func{S_i}{S_{i+1}}$ as follows:
  \begin{itemize}
  \item on objects: $u_i X \ddefeq (X , \lambda x . \unitty)$
  \item on morphisms: $u_i f \ddefeq (f , \lambda a\ x . x)$
  \end{itemize}
  We then have to check whether we have for any $X : | S_i |$ and
  $(Y,Q) : | S_{i+1} |$ that
  $$
  S_{i+1}(u_i\ X , (Y,Q)) = S_i(X,Y)
  $$
  which we can show by simple equational reasoning:
  \begin{align*}
      &&S_{i+1}(u_i\ X , (Y,Q)) \\
    &=& S_{i+1}((X,\lambda x . \unitty), (Y,Q)) \\
    &=& (f : S_i(X,Y) \times (g : (a : R_{i+1} X) \to \unitty \to \unitty) \\
    &=& S_i(X,Y)
  \end{align*}

\end{proof}

\subsection{Categories of algebras}

\subsubsection{0-constructors}

\subsubsection{1-constructors}

\todo{This is related to the ``On the Construction of Free Algebras
  for Equational Systems'' paper}
